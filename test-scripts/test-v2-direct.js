#!/usr/bin/env node

/**
 * V2ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç›´æ¥ãƒ†ã‚¹ãƒˆ
 * APIçµŒç”±ã§ã¯ãªãç›´æ¥é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ãƒ†ã‚¹ãƒˆ
 */

require('dotenv').config({ path: '.env.local' })
const OpenAI = require('openai')

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
})

async function testConceptGeneration() {
  console.log('ğŸ§ª V2ã‚³ãƒ³ã‚»ãƒ—ãƒˆç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ç›´æ¥ãƒ†ã‚¹ãƒˆ')
  console.log('==========================================\n')
  
  // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒˆãƒ”ãƒƒã‚¯
  const topic = {
    TOPIC: "AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå¤‰ãˆã‚‹æœªæ¥ã®åƒãæ–¹ï¼š2025å¹´ã®è·å ´é©å‘½",
    perplexityAnalysis: "OpenAIã‚„GoogleãŒç›¸æ¬¡ã„ã§AIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ©Ÿèƒ½ã‚’ç™ºè¡¨ã—ã€å®Ÿéš›ã®æ¥­å‹™ã§ã®æ´»ç”¨äº‹ä¾‹ãŒæ€¥å¢—ã€‚ç‰¹ã«äº‹å‹™ä½œæ¥­ã®è‡ªå‹•åŒ–ã«ã‚ˆã‚Šã€äººé–“ã®å½¹å‰²ãŒå¤§ããå¤‰åŒ–ã™ã‚‹ã“ã¨ã¸ã®æœŸå¾…ã¨ä¸å®‰ãŒå…¥ã‚Šæ··ã˜ã£ãŸè­°è«–ãŒæ´»ç™ºåŒ–ã—ã¦ã„ã‚‹ã€‚",
    url: "https://example.com/ai-agent-workplace-2025"
  }
  
  const session = {
    platform: 'Twitter',
    style: 'ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ¡ãƒ³ãƒˆ'
  }
  
  const topicIndex = 0
  
  // æ–°ã—ã„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
  const prompt = `ã‚ãªãŸã¯ã€æ–°ãŸãªãƒˆãƒ¬ãƒ³ãƒ‰ã‚’ç‰¹å®šã—ã€æµè¡Œã®æ³¢ãŒãƒ”ãƒ¼ã‚¯ã«é”ã™ã‚‹å‰ã«ãã®æ³¢ã«ä¹—ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ä½œæˆã™ã‚‹ãƒã‚ºã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æˆ¦ç•¥å®¶ã§ã™ã€‚

ä»¥ä¸‹ã®ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦ã€ã€${session.platform}ã€‘ã§ã€${session.style}ã€‘ã‚¹ã‚¿ã‚¤ãƒ«ã§ãƒã‚ºã‚‹æŠ•ç¨¿ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’3ã¤ä½œæˆã—ã¦ãã ã•ã„ã€‚

ãƒˆãƒ”ãƒƒã‚¯: ${topic.TOPIC}
åˆ†æ: ${topic.perplexityAnalysis}
URL: ${topic.url}

ã€ãƒ•ãƒƒã‚¯ã€‘

â—ä»¥ä¸‹ã®5ç¨®é¡ã®ã†ã¡ã„ãšã‚Œã‹ï¼ˆã¾ãŸã¯çµ„ã¿åˆã‚ã›ï¼‰ã‚’ä½¿ã£ã¦ã€å¿ƒã‚’ã¤ã‹ã‚€ã€Œã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ•ãƒƒã‚¯ã€ã‚’3ã¤è€ƒãˆã¦ãã ã•ã„ï¼š
    1.    æ„å¤–æ€§ï¼ˆSurpriseï¼‰ï¼šå¸¸è­˜ã®é€†ã‚’ã¤ãï¼æƒ³å®šå¤–ã®å±•é–‹
    2.    ç·Šæ€¥æ€§ï¼ˆUrgencyï¼‰ï¼šä»Šã™ãçŸ¥ã‚‹ã¹ãï¼æ™‚é–“ã‚„æœŸé™ã‚’æ„è­˜ã•ã›ã‚‹
    3.    è‡ªå·±æŠ•å½±ï¼ˆIdentityï¼‰ï¼šèª­è€…ãŒã€Œè‡ªåˆ†ã®ã“ã¨ã ã€ã¨æ„Ÿã˜ã‚‹è¦–ç‚¹
    4.    æ•°å­—ãƒ»ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆClarityï¼‰ï¼šãƒ‡ãƒ¼ã‚¿ã‚„å…·ä½“æ€§ã«ã‚ˆã‚‹èª¬å¾—åŠ›
    5.    å•ã„ãƒ»æœªå®Œæ€§ï¼ˆTensionï¼‰ï¼šç­”ãˆãŒçŸ¥ã‚ŠãŸããªã‚‹å•ã„ã‹ã‘ï¼é€”ä¸­ã§æ­¢ã‚ã‚‹ä½™ç™½

â¸»

ã€è§’åº¦ã€‘

â—ä¸Šè¨˜ã®ãƒ•ãƒƒã‚¯ã‚’æ´»ã‹ã—ã€ä»¥ä¸‹ã®è¦³ç‚¹ã‚’ã‚‚ã¨ã«"ç‹¬è‡ªã®åˆ‡ã‚Šå£"ã‚’3ã¤æ§‹æƒ³ã—ã¦ãã ã•ã„ï¼š
    â€¢    ä¸–ã®æµã‚Œã«å¯¾ã—ã¦"é€†å¼µã‚Šã™ã‚‹"è¦–ç‚¹
    â€¢    å½“äº‹è€…ã‚„å°‚é–€å®¶ã®"ãƒªã‚¢ãƒ«ãªå£°"ã«åŸºã¥ãåˆ†æ
    â€¢    å€‹äººçš„ãªä½“é¨“ã‚„äººé–“é–¢ä¿‚ã‚’èµ·ç‚¹ã¨ã—ãŸ"ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‹"
    â€¢    èƒŒæ™¯ã‚„æ§‹é€ ã‚’è§£ãã»ãã™"ã‚ã‹ã‚Šã‚„ã™ã„è§£èª¬å‹"
    â€¢    ä»Šå¾Œã®å‹•ãã‚„æ³¢åŠåŠ¹æœã‚’èª­ã‚€"äºˆæ¸¬ãƒ»è€ƒå¯Ÿå‹"
    â€¢    è¦‹ãˆã¥ã‚‰ã„éƒ¨åˆ†ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹"èˆå°è£ã‚„è£è©±çš„è¦–ç‚¹"
    â€¢    éå»ã®å‡ºæ¥äº‹ã¨ã®"æ¯”è¼ƒã‚„å‚ç…§"ã«ã‚ˆã‚‹æ§‹é€ çš„è¦–ç‚¹
    â€¢    èª¤è§£ã‚„å¸¸è­˜ã‚’è¦†ã™"ç¥è©±ç ´å£Šå‹"
    â€¢    å…·ä½“ä¾‹ã‚’æ·±å €ã‚Šã™ã‚‹"ã‚±ãƒ¼ã‚¹ã‚¹ã‚¿ãƒ‡ã‚£å‹"
    â€¢    çµ±è¨ˆã‚„ã‚°ãƒ©ãƒ•ã§èªã‚‹"ãƒ‡ãƒ¼ã‚¿é§†å‹•å‹"
    â€¢    ç¤¾ä¼šçš„èª²é¡Œã‚’æµ®ãå½«ã‚Šã«ã™ã‚‹"å•é¡Œæèµ·å‹"
    â€¢    å®Ÿç”¨çš„ãªãƒ’ãƒ³ãƒˆã‚’æä¾›ã™ã‚‹"ãƒ©ã‚¤ãƒ•ãƒãƒƒã‚¯å‹"

â¸»

ã€æŠ•ç¨¿æ§‹é€ ã€‘

â—ä¸‹è¨˜ã®æµã‚Œã«æ²¿ã£ã¦ã€1æŠ•ç¨¿ã‚’æ§‹æˆã—ã¦ãã ã•ã„ï¼š
    1.    ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ•ãƒƒã‚¯
ã€€ğŸ‘‰ èˆˆå‘³ã‚’å¼•ãæœ€åˆã®ä¸€æ–‡ï¼ˆé©šããƒ»å•ã„ãƒ»é€†èª¬ ãªã©ï¼‰
ã€€ä¾‹ï¼šã€ŒãŸã£ãŸ1ã¤ã®å·¥å¤«ã§ã€ä»•äº‹ãŒ3å€é€Ÿããªã‚‹ã¨ã—ãŸã‚‰ï¼Ÿã€
    2.    èƒŒæ™¯ï¼å•é¡Œæèµ·ï¼ˆWhyï¼‰
ã€€ğŸ‘‰ ãªãœãã®è©±ãŒä»Šé‡è¦ãªã®ã‹ï¼ã©ã‚“ãªèª²é¡Œã‚’æ‰±ã†ã®ã‹
ã€€ä¾‹ï¼šã€Œå¤šãã®äººãŒã€"æƒ…å ±ã«æŒ¯ã‚Šå›ã•ã‚Œã‚‹åƒãæ–¹"ã‚’ã—ã¦ã„ã‚‹ã€
    3.    å…·ä½“çš„ãªä¸­èº«ï¼ˆWhat/Howï¼‰
ã€€ğŸ‘‰ ãƒã‚¦ãƒã‚¦ãƒ»ä½“é¨“è«‡ãƒ»æ•°å­—ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãªã©ã€‚ç®‡æ¡æ›¸ãã§ã‚‚å¯
ã€€ä¾‹ï¼šã€Œã¼ããŒè©¦ã—ãŸã®ã¯ã€"æœ10åˆ†ã ã‘ã®â—‹â—‹ç¿’æ…£"ã€
    4.    ã¾ã¨ã‚ãƒ»å†…çœãƒ»å…±æ„Ÿï¼ˆSo Whatï¼‰
ã€€ğŸ‘‰ èª­è€…ã«å•ã„ã‹ã‘ã‚‹ï¼å…±æ„Ÿã‚’å¼•ãå‡ºã™ï¼ä¾¡å€¤ã¥ã‘ã™ã‚‹
ã€€ä¾‹ï¼šã€Œå¤§åˆ‡ãªã®ã¯ã€ãƒ„ãƒ¼ãƒ«ã˜ã‚ƒãªã"ä½¿ã„æ–¹"ã ã£ãŸã€
    5.    CTAï¼ˆè¡Œå‹•ã®ãã£ã‹ã‘ï¼‰
ã€€ğŸ‘‰ ã‚³ãƒ¡ãƒ³ãƒˆãƒ»RTãƒ»ä¿å­˜ãƒ»ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«èª˜å°ãªã©
ã€€ä¾‹ï¼šã€Œã‚ãªãŸã®ç¿’æ…£è¡“ã€ã‚ˆã‹ã£ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€

â¸»

ã€ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¡ˆã€‘

â—æŠ•ç¨¿ã®å°è±¡ã‚’é«˜ã‚ã‚‹ç”»åƒã‚„å‹•ç”»ã®æ–¹å‘æ€§ã‚’ææ¡ˆã—ã¦ãã ã•ã„ã€‚ä¾‹ï¼š
    â€¢    ã‚°ãƒ©ãƒ•ã‚„æ•°å­—ã‚’å¼·èª¿ã—ãŸã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯
    â€¢    beforeâ†’afterã§å¤‰åŒ–ãŒä¼ã‚ã‚‹2æšæ¯”è¼ƒç”»åƒ
    â€¢    æ„Ÿæƒ…ã«è¨´ãˆã‚‹å†™çœŸï¼ˆé¡”ãƒ»æ‰‹ãƒ»ç©ºãƒ»ç´™ãªã©ã®æŠ½è±¡ï¼‰
    â€¢    æ‰‹æ›¸ãé¢¨ã®å›³è§£
    â€¢    ãƒ¢ãƒãƒ­ãƒ¼ã‚°ç³»ã®é™ã‹ãªå‹•ç”»

â¸»

ã€æŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã€‘

â—ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã«åˆã‚ã›ã¦ã€æœ€é©ãªæŠ•ç¨¿æ™‚é–“å¸¯ã¨æ›œæ—¥ã‚’æç¤ºã—ã¦ãã ã•ã„ã€‚ä¾‹ï¼š
    â€¢    å¹³æ—¥å¤œï¼ˆ21æ™‚ã€œ23æ™‚ï¼‰
    â€¢    æ—¥æ›œå¤•æ–¹ï¼ˆã€Œæ˜æ—¥ã‹ã‚‰ã€ãƒ¢ãƒ¼ãƒ‰ã‚’æ´»ç”¨ï¼‰
    â€¢    æœˆæ›œæœï¼ˆãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ç³»ã«å¼·ã„ï¼‰

ã€è§’åº¦ã®çµ„ã¿åˆã‚ã›ãƒ«ãƒ¼ãƒ«ã€‘
- å„ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¯ç•°ãªã‚‹è§’åº¦ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨
- 2-3å€‹ã®è§’åº¦ã‚’çµ„ã¿åˆã‚ã›ã‚‹å ´åˆã¯ã€ç›¸ä¹—åŠ¹æœã‚’ç‹™ã†ã“ã¨
- åŒã˜è§’åº¦ã®çµ„ã¿åˆã‚ã›ã‚’ç¹°ã‚Šè¿”ã•ãªã„ã“ã¨

ã¾ãŸã€æ§‹æƒ³ã—ãŸã‚³ãƒ³ã‚»ãƒ—ãƒˆãŒä¸€ç›®ã§åˆ†ã‹ã‚‹ã‚ˆã†ã€å„ã‚³ãƒ³ã‚»ãƒ—ãƒˆã«20æ–‡å­—ä»¥å†…ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä»˜ã‘ã¦ãã ã•ã„ã€‚

æ§‹æƒ³ã—ãŸã‚³ãƒ³ã‚»ãƒ—ãƒˆã«ãµã•ã‚ã—ã„ã®ã¯å˜ç‹¬æŠ•ç¨¿ã‹ãƒ„ãƒªãƒ¼æŠ•ç¨¿ã‹ã‚‚æŒ‡ç¤ºã—ã¦ãã ã•ã„ã€‚
- single: å˜ç‹¬æŠ•ç¨¿ï¼ˆ140æ–‡å­—ä»¥å†…ã§å®Œçµï¼‰
- thread: ãƒ„ãƒªãƒ¼æŠ•ç¨¿ï¼ˆè¤‡æ•°ã®æŠ•ç¨¿ã§è©³ç´°ã«å±•é–‹ï¼‰

å¿…ãšä»¥ä¸‹ã®JSONå½¢å¼ã§3ã¤ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š
[
  {
    "conceptId": "topic${topicIndex + 1}_concept1",
    "conceptTitle": "ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ20æ–‡å­—ä»¥å†…ï¼‰",
    "format": "single/threadã®ã„ãšã‚Œã‹",
    "hookType": "ä½¿ç”¨ã—ãŸãƒ•ãƒƒã‚¯ã®ç¨®é¡",
    "hookCombination": ["çµ„ã¿åˆã‚ã›ãŸå ´åˆã®ãƒ•ãƒƒã‚¯ã‚¿ã‚¤ãƒ—"],
    "angle": "ãƒ¡ã‚¤ãƒ³è§’åº¦",
    "angleCombination": ["ä½¿ç”¨ã—ãŸè§’åº¦ã®çµ„ã¿åˆã‚ã›"],
    "angleRationale": "ãªãœã“ã®è§’åº¦/çµ„ã¿åˆã‚ã›ãŒåŠ¹æœçš„ã‹ã€ãªãœã“ã®å½¢å¼ã‚’é¸ã‚“ã ã‹",
    "viralScore": 85,
    "viralFactors": ["ãƒã‚ºã‚‹è¦å› 1", "ãƒã‚ºã‚‹è¦å› 2"],
    "structure": {
      "openingHook": "ã©ã®ã‚ˆã†ãªé©šãã‚„å•ã„ã‹ã‘ã§å§‹ã‚ã‚‹ã‹",
      "background": "ã©ã‚“ãªç¾çŠ¶èªè­˜ã‚„å•é¡Œæ„è­˜ã‚’æç¤ºã™ã‚‹ã‹",
      "mainContent": "ã©ã‚“ãªäº‹å®Ÿãƒ»ä½“é¨“ãƒ»åˆ†æã‚’å±•é–‹ã™ã‚‹ã‹",
      "reflection": "ã©ã®ã‚ˆã†ãªå…±æ„Ÿãƒã‚¤ãƒ³ãƒˆã‚„ä¾¡å€¤ã¥ã‘ã‚’ã™ã‚‹ã‹",
      "cta": "ã©ã‚“ãªè¡Œå‹•ã‚’ä¿ƒã™ã‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒ»RTãƒ»ä¿å­˜ãªã©ï¼‰"
    },
    "visual": "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¡ˆ",
    "timing": "æŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°",
    "hashtags": ["é–¢é€£ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°"]
  },
  {
    "conceptId": "topic${topicIndex + 1}_concept2",
    "conceptTitle": "ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ20æ–‡å­—ä»¥å†…ï¼‰",
    "format": "single/threadã®ã„ãšã‚Œã‹",
    "hookType": "ä½¿ç”¨ã—ãŸãƒ•ãƒƒã‚¯ã®ç¨®é¡",
    "hookCombination": ["çµ„ã¿åˆã‚ã›ãŸå ´åˆã®ãƒ•ãƒƒã‚¯ã‚¿ã‚¤ãƒ—"],
    "angle": "ãƒ¡ã‚¤ãƒ³è§’åº¦",
    "angleCombination": ["ä½¿ç”¨ã—ãŸè§’åº¦ã®çµ„ã¿åˆã‚ã›"],
    "angleRationale": "ãªãœã“ã®è§’åº¦/çµ„ã¿åˆã‚ã›ãŒåŠ¹æœçš„ã‹ã€ãªãœã“ã®å½¢å¼ã‚’é¸ã‚“ã ã‹",
    "viralScore": 82,
    "viralFactors": ["ãƒã‚ºã‚‹è¦å› 1", "ãƒã‚ºã‚‹è¦å› 2"],
    "structure": {
      "openingHook": "ã©ã®ã‚ˆã†ãªé©šãã‚„å•ã„ã‹ã‘ã§å§‹ã‚ã‚‹ã‹",
      "background": "ã©ã‚“ãªç¾çŠ¶èªè­˜ã‚„å•é¡Œæ„è­˜ã‚’æç¤ºã™ã‚‹ã‹",
      "mainContent": "ã©ã‚“ãªäº‹å®Ÿãƒ»ä½“é¨“ãƒ»åˆ†æã‚’å±•é–‹ã™ã‚‹ã‹",
      "reflection": "ã©ã®ã‚ˆã†ãªå…±æ„Ÿãƒã‚¤ãƒ³ãƒˆã‚„ä¾¡å€¤ã¥ã‘ã‚’ã™ã‚‹ã‹",
      "cta": "ã©ã‚“ãªè¡Œå‹•ã‚’ä¿ƒã™ã‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒ»RTãƒ»ä¿å­˜ãªã©ï¼‰"
    },
    "visual": "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¡ˆ",
    "timing": "æŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°",
    "hashtags": ["é–¢é€£ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°"]
  },
  {
    "conceptId": "topic${topicIndex + 1}_concept3",
    "conceptTitle": "ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ20æ–‡å­—ä»¥å†…ï¼‰",
    "format": "single/threadã®ã„ãšã‚Œã‹",
    "hookType": "ä½¿ç”¨ã—ãŸãƒ•ãƒƒã‚¯ã®ç¨®é¡",
    "hookCombination": ["çµ„ã¿åˆã‚ã›ãŸå ´åˆã®ãƒ•ãƒƒã‚¯ã‚¿ã‚¤ãƒ—"],
    "angle": "ãƒ¡ã‚¤ãƒ³è§’åº¦",
    "angleCombination": ["ä½¿ç”¨ã—ãŸè§’åº¦ã®çµ„ã¿åˆã‚ã›"],
    "angleRationale": "ãªãœã“ã®è§’åº¦/çµ„ã¿åˆã‚ã›ãŒåŠ¹æœçš„ã‹ã€ãªãœã“ã®å½¢å¼ã‚’é¸ã‚“ã ã‹",
    "viralScore": 88,
    "viralFactors": ["ãƒã‚ºã‚‹è¦å› 1", "ãƒã‚ºã‚‹è¦å› 2"],
    "structure": {
      "openingHook": "ã©ã®ã‚ˆã†ãªé©šãã‚„å•ã„ã‹ã‘ã§å§‹ã‚ã‚‹ã‹",
      "background": "ã©ã‚“ãªç¾çŠ¶èªè­˜ã‚„å•é¡Œæ„è­˜ã‚’æç¤ºã™ã‚‹ã‹",
      "mainContent": "ã©ã‚“ãªäº‹å®Ÿãƒ»ä½“é¨“ãƒ»åˆ†æã‚’å±•é–‹ã™ã‚‹ã‹",
      "reflection": "ã©ã®ã‚ˆã†ãªå…±æ„Ÿãƒã‚¤ãƒ³ãƒˆã‚„ä¾¡å€¤ã¥ã‘ã‚’ã™ã‚‹ã‹",
      "cta": "ã©ã‚“ãªè¡Œå‹•ã‚’ä¿ƒã™ã‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãƒ»RTãƒ»ä¿å­˜ãªã©ï¼‰"
    },
    "visual": "ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«æ¡ˆ",
    "timing": "æŠ•ç¨¿ã‚¿ã‚¤ãƒŸãƒ³ã‚°",
    "hashtags": ["é–¢é€£ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°"]
  }
]`
  
  try {
    console.log('ğŸ“¤ OpenAI APIã‚’å‘¼ã³å‡ºã—ä¸­...')
    const startTime = Date.now()
    
    const response = await openai.chat.completions.create({
      model: 'gpt-4o',
      messages: [
        {
          role: 'system',
          content: 'JSONå½¢å¼ã§æ­£ç¢ºã«å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚'
        },
        {
          role: 'user',
          content: prompt
        }
      ],
      temperature: 0.8,
      max_tokens: 3500
    })
    
    const endTime = Date.now()
    console.log(`âœ… å¿œç­”å—ä¿¡ï¼ˆ${(endTime - startTime) / 1000}ç§’ï¼‰\n`)
    
    const content = response.choices[0].message.content || '[]'
    let concepts = []
    
    try {
      concepts = JSON.parse(content)
    } catch (e) {
      console.error('JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã€‚ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ¢ã—ã¦ã„ã¾ã™...')
      const jsonMatch = content.match(/\[[\s\S]*\]/);
      if (jsonMatch) {
        try {
          concepts = JSON.parse(jsonMatch[0])
        } catch (e2) {
          console.error('âŒ JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—:', e2.message)
          console.log('ç”Ÿã®å¿œç­”:', content)
          return
        }
      }
    }
    
    console.log(`âœ… ${concepts.length}å€‹ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ\n`)
    
    // çµæœã®è¡¨ç¤º
    concepts.forEach((concept, i) => {
      console.log(`${'='.repeat(60)}`)
      console.log(`ğŸ¯ ã‚³ãƒ³ã‚»ãƒ—ãƒˆ${i + 1}: ${concept.conceptTitle || 'âŒ ã‚¿ã‚¤ãƒˆãƒ«ãªã—'}`)
      console.log(`${'='.repeat(60)}`)
      console.log(`ğŸ“Œ ID: ${concept.conceptId}`)
      console.log(`ğŸ“ å½¢å¼: ${concept.format} ${concept.format === 'carousel' ? 'âš ï¸ (å»ƒæ­¢äºˆå®š)' : 'âœ…'}`)
      console.log(`ğŸ£ ãƒ•ãƒƒã‚¯: ${concept.hookType}`)
      if (concept.hookCombination?.length > 0) {
        console.log(`   çµ„ã¿åˆã‚ã›: ${concept.hookCombination.join(' + ')}`)
      }
      console.log(`ğŸ­ è§’åº¦: ${concept.angle}`)
      if (concept.angleCombination?.length > 0) {
        console.log(`   çµ„ã¿åˆã‚ã›: ${concept.angleCombination.join(' + ')}`)
      }
      console.log(`ğŸ’¡ ç†ç”±: ${concept.angleRationale}`)
      console.log(`ğŸ“Š ãƒã‚¤ãƒ©ãƒ«ã‚¹ã‚³ã‚¢: ${concept.viralScore}`)
      console.log(`âœ¨ ãƒã‚¤ãƒ©ãƒ«è¦å› : ${concept.viralFactors?.join(', ')}`)
      
      if (concept.structure) {
        console.log(`\nğŸ“‹ æŠ•ç¨¿æ§‹é€ :`)
        console.log(`  1ï¸âƒ£ ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°: ${concept.structure.openingHook}`)
        console.log(`  2ï¸âƒ£ èƒŒæ™¯: ${concept.structure.background}`)
        console.log(`  3ï¸âƒ£ ä¸­èº«: ${concept.structure.mainContent}`)
        console.log(`  4ï¸âƒ£ å†…çœ: ${concept.structure.reflection}`)
        console.log(`  5ï¸âƒ£ CTA: ${concept.structure.cta}`)
      }
      
      console.log(`\nğŸ¨ ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«: ${concept.visual}`)
      console.log(`â° ã‚¿ã‚¤ãƒŸãƒ³ã‚°: ${concept.timing}`)
      console.log(`#ï¸âƒ£ ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°: ${concept.hashtags?.join(' ')}`)
      console.log()
    })
    
    // æ¤œè¨¼
    console.log('\n' + '='.repeat(60))
    console.log('ğŸ“Š ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ”¹å–„ã®æ¤œè¨¼çµæœ')
    console.log('='.repeat(60))
    
    const hasAllTitles = concepts.every(c => c.conceptTitle && c.conceptTitle.length > 0)
    console.log(`âœ… conceptTitle: ${hasAllTitles ? 'å…¨ã¦ç”Ÿæˆæ¸ˆã¿ âœ…' : 'âŒ æ¬ æã‚ã‚Š'}`)
    
    const formats = [...new Set(concepts.map(c => c.format))]
    console.log(`âœ… formatç¨®é¡: ${formats.join(', ')} ${formats.includes('carousel') ? 'âš ï¸' : 'âœ…'}`)
    
    const hasFormatRationale = concepts.every(c => 
      c.angleRationale && (c.angleRationale.includes('single') || c.angleRationale.includes('thread') || c.angleRationale.includes('æŠ•ç¨¿'))
    )
    console.log(`âœ… å½¢å¼é¸æŠç†ç”±: ${hasFormatRationale ? 'å…¨ã¦å«ã¾ã‚Œã¦ã„ã‚‹ âœ…' : 'âŒ ä¸€éƒ¨æ¬ æ'}`)
    
    const angles = [...new Set(concepts.map(c => c.angle))]
    console.log(`âœ… è§’åº¦ã®å¤šæ§˜æ€§: ${angles.length}ç¨®é¡`)
    angles.forEach((angle, i) => console.log(`   ${i + 1}. ${angle}`))
    
    console.log('\nâœ¨ ãƒ†ã‚¹ãƒˆå®Œäº†ï¼')
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error.message)
    console.error(error.stack)
  }
}

// å®Ÿè¡Œ
testConceptGeneration()