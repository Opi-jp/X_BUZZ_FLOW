# プロンプトエディター仕様書

*作成日: 2025年6月18日*

## 目的

X_BUZZ_FLOWプロジェクトにおけるChain of Thought（CoT）プロンプトの品質向上と管理効率化を実現するためのエディターツールを開発する。

## 背景

### 現在の課題
1. **プロンプトの誤解による連鎖的問題**
   - 「3+5=8つのコンセプト？」のような誤解が全体設計を破壊
   - 一度間違えると修正が極めて困難

2. **実装とドキュメントの乖離**
   - プロンプトの「方向性」問題（抽象的vs具体的）
   - LLMが勝手に「改善」して意図が変わる

3. **Chain of Thoughtの本質理解不足**
   - プログラミング的発想での設計
   - 創造性を殺すテンプレート化

## 機能要件

### 1. プロンプト編集機能
- **リアルタイム編集**: システムプロンプトとユーザープロンプトの編集
- **構文ハイライト**: 変数（${theme}など）、JSON部分の色分け
- **テンプレート管理**: Step1/2/3の各テンプレート保存・読み込み
- **差分表示**: オリジナルとの差分をリアルタイム表示

### 2. プロンプトテスト機能
- **単体テスト**: 各ステップを個別に実行
- **統合テスト**: Step1→2→3の連続実行
- **A/Bテスト**: 複数バージョンの比較実行
- **モックデータ**: テスト用の仮想入力データ

### 3. 問題検出機能
- **危険ワード検出**:
  - 「方向性」「主な」などの曖昧な表現
  - 「選択してください」などの固定化表現
  - コメントアウト（//や/**/）

- **構造チェック**:
  - ガイド部分と出力指示の分離確認
  - JSON形式の妥当性
  - フィールド名の具体性チェック

- **Chain of Thought原則チェック**:
  - 創造性を促す表現の有無
  - 関数的発想の検出
  - テンプレート化の警告

### 4. 品質スコアリング
- **創造性スコア**: LLMの思考余地の評価
- **具体性スコア**: 指示の明確さ評価
- **連携性スコア**: ステップ間の整合性評価
- **総合スコア**: 上記を統合した品質評価

### 5. プロンプト履歴管理
- **バージョン管理**: 変更履歴の記録
- **変更理由**: 各変更の意図を記録
- **実行結果**: テスト結果の紐付け
- **ロールバック**: 過去バージョンへの復元

### 6. ガイド機能
- **ベストプラクティス表示**: 推奨される書き方のヒント
- **アンチパターン警告**: よくある失敗の警告
- **例文サジェスト**: 効果的な表現の提案
- **用語集**: Chain of Thought関連用語の説明

## 技術仕様

### アーキテクチャ
```
/app/prompt-editor/
├── page.tsx              # メインページ
├── components/
│   ├── PromptEditor.tsx  # エディター本体
│   ├── TestRunner.tsx    # テスト実行UI
│   ├── ScorePanel.tsx    # スコア表示
│   ├── HistoryPanel.tsx  # 履歴管理
│   └── GuidePanel.tsx    # ガイド表示
├── lib/
│   ├── prompt-analyzer.ts    # プロンプト分析
│   ├── test-executor.ts      # テスト実行
│   ├── score-calculator.ts   # スコア計算
│   └── prompt-storage.ts     # 履歴保存
└── types/
    └── prompt-editor.ts      # 型定義
```

### データモデル
```typescript
interface PromptVersion {
  id: string;
  timestamp: Date;
  author: string;
  step: 'collect-topics' | 'generate-concepts' | 'generate-contents';
  systemPrompt: string;
  userPrompt: string;
  changeReason: string;
  testResults?: TestResult[];
  scores: PromptScores;
}

interface PromptScores {
  creativity: number;      // 0-100
  specificity: number;     // 0-100
  coherence: number;       // 0-100
  overall: number;         // 0-100
}

interface TestResult {
  id: string;
  timestamp: Date;
  input: any;
  output: any;
  success: boolean;
  executionTime: number;
  model: string;
}
```

### UI/UXデザイン
- **3ペインレイアウト**:
  - 左: プロンプト編集エリア
  - 中央: テスト実行・結果表示
  - 右: スコア・ガイド・履歴

- **リアルタイムフィードバック**:
  - 編集中の問題をインライン表示
  - スコアの動的更新
  - 差分のハイライト

## 実装優先順位

### Phase 1（MVP）
1. 基本的な編集機能
2. 危険ワード検出
3. 単体テスト実行
4. 基本的なスコアリング

### Phase 2
1. A/Bテスト機能
2. 詳細な問題検出
3. プロンプト履歴管理
4. ガイド機能の充実

### Phase 3
1. 統合テスト機能
2. 高度なスコアリング
3. チーム共有機能
4. エクスポート/インポート

## 成功指標

1. **プロンプト品質の向上**
   - 平均スコア80以上の達成
   - エラー率の50%削減

2. **開発効率の改善**
   - プロンプト修正時間の70%短縮
   - テスト実行時間の80%短縮

3. **知識の蓄積**
   - 成功パターンの文書化
   - チーム全体のスキル向上

## リスクと対策

1. **過度な最適化**
   - リスク: 創造性を損なう可能性
   - 対策: 創造性スコアを重視

2. **複雑化**
   - リスク: ツール自体が難しくなる
   - 対策: 段階的な機能追加

3. **依存性**
   - リスク: ツールなしでプロンプトが書けなくなる
   - 対策: 教育的な要素を含める

## 今後の展開

1. **AI支援機能**
   - プロンプトの自動改善提案
   - 成功パターンの学習

2. **統合機能**
   - VS Code拡張機能
   - CI/CDパイプライン統合

3. **分析機能**
   - プロンプト効果の定量分析
   - ユーザー反応の相関分析