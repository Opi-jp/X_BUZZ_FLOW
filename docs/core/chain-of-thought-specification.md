# Chain of Thought プロンプト設計書 v3（2025年6月18日更新）

## 📌 このドキュメントについて
これは**プロンプトの設計書**であり、実装仕様書ではありません。
Chain of Thoughtの考え方と、各ステップで使用するプロンプトの構造を示しています。

## 🔄 最新アーキテクチャ（3ステップ実装）

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ Perplexity  │ --> │     GPT     │ --> │   Claude    │
│ (情報収集)   │     │ (分析・企画) │     │ (キャラ化)  │
└─────────────┘     └─────────────┘     └─────────────┘
```

### 旧アーキテクチャとの違い
- **旧**: 5フェーズ構成（GPTのみで完結）
- **新**: 3ステップ構成（各LLMの強みを活用）

## 基本原則

### 絶対に守るべきルール
1. **プロンプトを削らない** - LLMは自然言語で動作するため、文脈が重要
2. **評価基準をハードコードしない** - LLMに考えさせる
3. **各LLMの特性を活かす** - Perplexity（情報）、GPT（分析）、Claude（表現）
4. **自然言語での詳細な指示** - 短縮せず、人間に説明するように書く

## 新3ステップ実装のプロンプト設計

### Step 1: Perplexity - トレンド収集

#### 検索クエリ例
```
1. "{expertise}の最新トレンドとニュース 2025年"
2. "{expertise}で話題になっている議論や論争"
3. "{expertise}の未来予測と専門家の意見"
4. "{expertise}の成功事例と失敗事例"
```

#### コンテキスト
```
{platform}でバズる可能性が高い{expertise}のトピックを探しています。
特に感情的な反応や議論を呼ぶ内容に注目してください。
```

### Step 2: GPT - 分析・コンセプト生成

以下のプロンプトで機会評価とコンセプト作成を同時に実行：

```
下記の視点で分析を行い、
A：ウイルス速度指標
- 検索ボリュームの急増と成長率
- ソーシャルメンションの加速
- 複数プラットフォームの存在
- インフルエンサーの採用
- メディア報道の勢い

B：コンテンツアングル識別：実行可能なトレンドごとに、独自の角度を特定します。
- 反対派は世論に異議を唱える
- 専門家による内部視点の分析
- 個人的なつながりの物語
- 教育の内訳
- 次に何が起こるかを予測するコンテンツ
- 舞台裏の洞察
- 過去のイベントとの比較内容

その分析に基づいて、物語性を豊かに、下記の構造に基づいて、3つのコンセプトを提供してください。

●コンテンツコンセプトフレームワーク
それぞれの機会について、以下を開発します
A：形式: [スレッド/ビデオ/投稿タイプ]
B：フック: 「[注目を集める具体的なオープナー]」
C：角度: [独自の視点や見方]

●コンテンツ概要:
トレンドにつながるオープニングフック
[物語を構築する3～5つのキーポイント]
-予期せぬ洞察や啓示
-エンゲージメントを促進するCTA
-タイミング: 最大の効果を得るには [X] 時間以内に投稿してください
-ビジュアル: [具体的な画像/動画の説明]
-ハッシュタグ: [最適化されたタグ]

この際には、コンセプト作成のもととなったニュースソースとURLも必ず提示します。

出力は
A：形式: [スレッド/ビデオ/投稿タイプ]
B：フック: 「[注目を集める具体的なオープナー]」
C：角度: [独自の視点や見方]
D：3〜5個のキーポイント
で出力してください
```

### Step 3: Claude - キャラクター音声での仕上げ

```
コンセプト1: [トレンドトピック] - 完全なコンテンツ
[Xにすぐにコピー＆ペースト可能な完全なコンテンツを作成してください]
[すべてのテキスト、書式、改行、絵文字、ハッシュタグを含める]
[完成させてすぐに投稿できるように準備する]
視覚的説明: [必要な画像/ビデオの詳細な説明]
投稿に関する注意事項: [具体的なタイミングと最適化のヒント]

重要：単なる情報伝達ではなく、読者の感情を動かし、共感を生み、シェアしたくなる物語として構成してください。
```

#### プロンプト構造
```
あなたは{characterVoice}というキャラクターです。

以下のコンセプトを、あなたのキャラクターボイスで{platform}用の投稿として完成させてください：

コンセプト:
- トピック: {concept.topic}
- フック: {concept.hook}
- 角度: {concept.angle}
- キーポイント: {concept.keyPoints}

要件:
- {platform}の文字数制限に収める
- キャラクターの個性を全面に出す
- 読者の感情を動かし、行動を促す
- 適切な絵文字とハッシュタグを含める
```

## キャラクター定義の例

### Cardi Dare（デフォルト）
```
名前: Cardi Dare
性格: 大胆で挑発的、本音で語る
口調: カジュアルだが洞察的、時に皮肉も交える
特徴: 
- 常識に疑問を投げかける
- 本質を突く鋭い視点
- 読者を行動に駆り立てる
```

### その他のキャラクター例
- **Tech Sensei**: 技術的で分析的、専門知識を噛み砕いて説明
- **Trend Hunter**: 最新トレンドに敏感、キャッチーな表現
- **Wise Mentor**: 経験豊富、深い洞察と温かみのある助言

## 各LLMのシステムプロンプト

### GPT（Step 2）
```
あなたは、新たなトレンドを特定し、流行の波がピークに達する前にその波に乗るコンテンツのコンセプトを作成するバズるコンテンツ戦略家です。
```

### Claude（Step 3）
```
あなたは指定されたキャラクターとして、与えられたコンセプトを魅力的な投稿に仕上げる専門家です。
```

## 入出力の形式

### 入力
- **自然文での入力**を基本とする
- GPTが理解しやすい自然な日本語でプロンプトを構成

### 出力
- **JSON形式での出力**（DBに保存するため）
- 各フェーズのJSON構造は、次のフェーズで参照・使用される
- プロンプトには必ず「以下のJSON形式で出力してください」を含める

### JSON構造の連携
- Phase 1の出力 → Phase 2に渡す
- Phase 2の出力 → Phase 3に渡す
- Phase 3の出力 → Phase 4に渡す
- 各フェーズは前フェーズの出力JSONを受け取って処理
- DBに保存されたJSONデータをそのまま次のフェーズに渡す

## 実装における注意

### プロンプトの管理
1. **バージョン管理**: プロンプトの変更履歴を記録
2. **テンプレート化**: 変数部分を明確に分離
3. **テスト**: 各プロンプトの出力品質を定期的に確認

### エラー処理
1. **タイムアウト**: Perplexity（120秒）、GPT（30秒）、Claude（30秒）
2. **リトライ**: 各ステップで最大2回まで再試行
3. **フォールバック**: エラー時の代替処理を準備

### パフォーマンス最適化
1. **並列処理**: 可能な部分は並列実行
2. **キャッシュ**: 同じ検索結果の再利用
3. **トークン管理**: 各LLMのトークン制限を考慮

## 関連ドキュメント
- `/docs/core/chain-of-thought-philosophy.md` - CoTの設計思想
- `/lib/generation/unified-content-generator.ts` - 実装コード