# V2プロンプト動作記録（2025年6月18日）

## 概要
これは設計書ではなく、実際に動作している実装の記録です。

## 現在の動作仕様

### 全体構成
- **2トピック × 3コンセプト = 6パターン**
- Step 1: Perplexityで2つのトピックを収集
- Step 2: GPTで各トピックに3つのコンセプトを生成（計6つ）
- Step 3: 選択されたコンセプトのみコンテンツ生成

### Step 1: トピック収集（collect-topics）

#### 実際のプロンプト
```
あなたは、新たなトレンドを特定し、流行の波がピークに達する前にその波に乗るコンテンツのコンセプトを作成するバズるコンテンツ戦略家です。

【${session.theme}】について【${session.platform}】において【${session.style}】で発信するためのバズるコンテンツを作成したいです。

以下の視点でトレンド情報を収集・分析し、直近でバズリそうなトピックを2つ特定してください。

重要な要件：
- 必ず最低でも1つは48時間以内のニュースソースを含めてください
- 判断の元となったニュースソースのURLを全て明記してください（複数可）
- 各トピックごとに複数のソースがある場合は、additionalSourcesフィールドに含めてください

[A〜Dの視点の詳細は省略]
```

#### 処理の特徴
- 最大2つのトピックを処理（topics.slice(0, 2)）
- 24時間以内の同じテーマのトピックを再利用可能（reuseTopics: true）

### Step 2: コンセプト生成（generate-concepts）

#### 実際のプロンプト（抜粋）
```
以下のトピックについて、【${session.platform}】で【${session.style}】スタイルでバズる投稿コンセプトを3つ作成してください。

【フック】
下記の5種類を戦略的に組み合わせて、多様なフックを考えてください
1. 意外性（Surprise）- 常識を覆す事実、逆説的な視点
2. 緊急性（Urgency）- 今知るべき理由、期限がある情報
3. 自己投影（Identity）- 読者が共感する立場、「あなたも」という視点
4. 数字・ロジック（Clarity）- 具体的データ、明確な根拠
5. 問い・未完性（Tension）- 答えを知りたくなる質問、議論を呼ぶ問題提起

【角度の多様性】
以下の12種類から、各コンセプトで異なる角度（または複数の角度の組み合わせ）を使用してください：
[12種類の角度リスト]

【投稿構造】
5段階の構造（オープニングフック→背景→中身→内省→CTA）

必ず以下のJSON形式で3つのコンセプトを出力してください
```

#### 処理の特徴
- 各トピックに対して3つのコンセプト
- 異なる形式（single、thread、carousel）を提案
- 方向性のみ記載（実際の投稿文ではない）
- 各コンセプトには次フェーズで必要な全情報を含む：
  - hookType/hookCombination（選択したフック）
  - angle/angleCombination（選択した角度）
  - angleRationale（なぜ効果的か - 新規生成）
  - viralScore/viralFactors（評価 - 新規生成）
  - structure（5段階構造の解釈 - 各コンセプトで異なる）

### Step 3: コンテンツ生成（generate-contents）

#### 処理の特徴
- selectedIdsで選択されたコンセプトのみ処理
- 実際の投稿文を生成
- プラットフォーム別の最適化

## 修正履歴

### 2025年6月18日
- コンセプト数を8つから3つに修正
- トピック収集数を3つから2つに修正（実装は元から2つだった）
- ドキュメントと実装の整合性を確保

## 既知の問題
1. theme.split('と')のロジックが固定的
2. スレッド形式の実装が不完全
3. 文字数制限の考慮が不十分

## プロンプト設計の原則

### 入力と出力は1:1対応ではない
- **ガイド部分（入力）**: LLMに考え方を示す自然言語
  - 5種類のフック、12種類の角度は「参考材料」
  - 物語構造は「全体の流れの指示」
- **JSON部分（出力）**: 次フェーズで必要な構造化データ
  - LLMが創造的に生成した新情報を含む
  - ガイドをどう解釈・適用したかの結果

### 逆算設計
- Step 3が必要とする情報からStep 2の出力を設計
- Step 2が必要とする情報からStep 1の出力を設計
- 各フィールドには次フェーズでの用途がある

### 非関数的な設計
- プロンプトで関数定義してはいけない（創造性を殺す）
- 順序性が重要（1→2→3→4→5の物語構造）
- 文脈を保った全体的な思考を促す

## 重要な注意事項
- このドキュメントは実装の現状を記録したものです
- 設計変更時は必ず実装も同時に変更してください
- プロンプトの文言は実装から直接コピーしています
- JSON構造を安易に削除しない（次フェーズへの影響を考慮）