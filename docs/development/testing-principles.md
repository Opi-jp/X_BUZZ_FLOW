# Chain of Thoughtテスト原則

## 基本理念
「完走」よりも「正しい実装」を優先する

## よくある失敗パターン

### 1. 完走のためのハードコード
```typescript
// ❌ 悪い例
if (opportunities.length === 0) {
  // テストを通すために固定データを追加
  opportunities.push({
    topic: "AIトレンド",
    score: 8
  })
}

// ✅ 良い例
if (opportunities.length === 0) {
  console.log('No opportunities found - this is OK')
  return { opportunities: [] }
}
```

### 2. 次フェーズのための強制
```typescript
// ❌ 悪い例
prompt: `必ず3つの機会を特定してください` // 次のフェーズが3つ前提

// ✅ 良い例
prompt: `バイラルの可能性がある機会を特定してください` // GPTの判断に委ねる
```

### 3. エラー回避のための制限
```typescript
// ❌ 悪い例
const score = Math.max(result.score, 7) // 低スコアを避ける

// ✅ 良い例
const score = result.score // GPTの評価を信頼
```

## テスト時の心構え

### Phase単位でのテスト
1. 各Phaseが独立して正しく動作することを確認
2. 出力が0個でも、予想外の形式でも受け入れる
3. エラーは修正ではなく、適切なハンドリングで対応

### 全体テスト
1. データが流れなくても「それが正しい結果」と受け入れる
2. GPTが「バイラル機会なし」と判断したらそれを尊重
3. 完走しないことも正常な結果

## アンチパターンチェックリスト

テスト実装時に以下をチェック：

- [ ] 「必ず」「最低◯個」などの強制がないか
- [ ] デフォルト値や固定値を入れていないか
- [ ] 次フェーズのために形式を強制していないか
- [ ] エラー時に固定データを返していないか
- [ ] スコアや評価を操作していないか

## 正しいテストの流れ

```
1. Phase 1実行
   → 0個の結果でもOK
   
2. Phase 2実行
   → 評価対象がなければスキップもOK
   
3. Phase 3実行
   → コンセプトが生成されなければそれも結果
   
4. Phase 4実行
   → コンテンツなしも受け入れる
   
5. Phase 5実行
   → 戦略なしも正常
```

## まとめ

**「動かすため」ではなく「正しく実装するため」のテストを心がける**

Chain of Thoughtの本質は、GPTに考えさせることです。
テストのためにその思考を制限することは、本末転倒です。