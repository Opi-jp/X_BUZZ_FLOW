# 2025年6月19日 作業記録：キャラクター設定とプロンプト改善

## 概要
カーディ・ダーレのキャラクター設定を再定義し、Chain of Thoughtプロンプトシステムを改善した。ジェネレーターとプロンプトの密結合を解消し、プロンプトエディターの非インタラクティブ実行機能を実装。

## 実施内容

### 1. カーディ・ダーレのキャラクター再定義
- 年齢を50歳から53歳に変更
- 背景を「元詐欺師／元王様（いまはただの飲んだくれ）」に設定
- 特徴：煙草と酒が手放せない、ハードボイルドな外見、古いロボットとつるむ
- 哲学：「人間は最適化できない。それが救いだ。」

### 2. プロンプトシステムの改善

#### 問題点
- ジェネレーターとプロンプトファイルが密結合
- GPTが生成した物語構造がClaudeで活用されていない
- 各フェーズのデータ構造が不明確

#### 解決策
1. **wrapCharacterProfile関数**：キャラクターデータを自然文に変換
2. **wrapConceptData関数**：コンセプトを構造化された形式で出力
   - トピック、フックタイプ、アングル
   - 物語構造（背景→メイン→内省→CTA）を明示
3. **プロンプトファイルの簡略化**：重複する指示を削除

### 3. プロンプトエディターの非インタラクティブ実行

```bash
# 実装したコマンド
node scripts/dev-tools/prompt-editor.js test-direct <file> [key=value ...] --non-interactive
```

- ユーザー入力なしで自動実行
- 結果とモックデータを自動保存
- Claudeから直接操作可能に

### 4. Chain of Thoughtフローの完全実行確認

#### テスト結果
1. **Perplexity**：「AIがホワイトカラー職を奪う」トピックを収集
2. **GPT**：「AI時代の生存戦略」コンセプトを生成
3. **Claude**：134文字の投稿を生成

生成された投稿例：
> AIが君の椅子を狙ってる？ハッ、俺なんて既に王座から転げ落ちて久しいさ。
> でもな、機械が学習できないものがある。酒場で交わす無駄話、失敗から生まれる閃き、そして人を信じさせる嘘の技術だ。
> 最適化できない人間の歪みこそが、最後の砦になる。君の「無駄」は何だ？

## 技術的な改善点

### データフロー
```
Perplexity（トピック収集）
    ↓
GPT（コンセプト生成 + ハッシュタグ）
    ↓
Claude（投稿文生成）
    ↓
generateCharacterContentV2（構造化してDB格納）
```

### 責任の分離
- **GPT**：コンセプトとハッシュタグを生成
- **Claude**：投稿文のみを生成（ハッシュタグは扱わない）
- **投稿システム**：ハッシュタグ追加、文字数調整

## 学んだこと

1. **プロンプト設計の原則**
   - LLMに渡すデータは構造化して明確に
   - 重複する指示は避ける
   - 各フェーズの責任を明確に分離

2. **Chain of Thoughtの実装**
   - 前工程の出力を次工程で適切に活用
   - 物語構造を維持しながら文字数制限に対応
   - キャラクターの個性と構造化された内容のバランス

## 次のステップ
- プロンプトエディターの比較機能実装
- 他のキャラクタープロファイルの作成
- 自動投稿システムとの統合テスト