# 検索結果処理に関する重要な議論（2025/06/14）

## 概要
Phase 1の検索結果をGPTがどのように分析するかについての技術的検討と課題整理。

## 現状の実装フロー

### 1. GPTによる検索クエリ生成
- **入力**: 発信したい分野（例：AIと働き方）、スタイル、プラットフォーム
- **出力**: 4つのカテゴリ（A〜D）から検索クエリを生成
  - A: 現在の出来事の分析
  - B: テクノロジーの発表とドラマ
  - C: ソーシャルリスニング研究
  - D: バイラルパターン認識

### 2. Google Custom Search API実行
- **検索パラメータ**: 
  - 各クエリで10件取得（`num=10`）
  - 7日以内の記事に限定（`dateRestrict=d7`）
- **結果**: 4クエリ × 10件 = 合計40件

### 3. DBに保存される情報
```
- title: 記事タイトル
- url: 記事URL
- snippet: Googleが提供する要約（100-150文字程度）
- source: ドメイン名
- query: 検索クエリ
- position: 検索順位
```

## 発見した重要な課題

### データの不十分性
1. **タイトルのみ**: トレンドの内容を推測するには不十分
2. **Snippetの制限**: 
   - 100-150文字の断片的な情報
   - 文脈が失われている
   - 感情的要素や議論の詳細が不明

### GPTが必要とする情報
- トレンドの背景と文脈
- 感情的な要素（議論性、共感性、緊急性）
- 具体的な事例、数値、引用
- 専門家の意見や大衆の反応

## 検討したソリューション

### オプション1: 記事本文の取得とサマリー
```
メリット：
- 完全な文脈を保持
- 深い分析が可能

デメリット：
- 処理時間が大幅に増加（40記事×取得&サマリー）
- APIコストの増加
- スクレイピングの技術的課題
```

### オプション2: 既存APIの活用
- **WebFetch API**: プロジェクト内に実装済み
- **Perplexity API**: リアルタイム情報取得に特化
- **実装方法**: URLを渡して記事内容を要約

### オプション3: 2段階分析アプローチ
```
第1段階: Snippetベースの粗い分析
- 40件をタイトルとsnippetで分類
- 有望なトピックを10-15件に絞る

第2段階: 詳細情報の取得
- 選別された記事のみ本文取得
- 詳細なサマリー生成
```

## 技術的考慮事項

### パフォーマンス
- 40記事の詳細取得: 約2-3分
- GPTサマリー生成: 各記事10-15秒
- 合計処理時間: 5-10分（並列処理で短縮可能）

### コスト
- Google Search API: 1000クエリ/$5
- GPTサマリー: 40記事×500トークン≈$0.20
- WebFetch/Perplexity: 使用量に応じて

### データ品質
- Snippetのみ: 表面的な分析
- フルコンテンツ: 深い洞察が可能
- トレードオフ: 速度 vs 品質

## 推奨アプローチ

### Phase 1: MVPとしてSnippetベースで実装
1. 現在のsnippetでGPTがどの程度分析できるか検証
2. バイラルトピック抽出の精度を評価
3. ユーザーフィードバックを収集

### Phase 2: 必要に応じて拡張
1. 精度が不十分な場合、2段階分析を実装
2. WebFetch APIを使用して選択的に詳細取得
3. 重要度に応じて記事を優先順位付け

## 実装上の注意点

### DB設計の拡張案
```sql
-- 既存のsearch_resultsテーブルに追加
ALTER TABLE search_results ADD COLUMN 
  content_summary TEXT,          -- 記事の要約（200-300文字）
  content_fetched BOOLEAN DEFAULT FALSE,  -- 詳細取得済みフラグ
  fetch_priority INTEGER,        -- 取得優先度
  metadata JSONB;               -- 追加メタデータ
```

### 処理フローの最適化
1. バックグラウンドジョブで記事取得
2. 優先度の高い記事から順次処理
3. キャッシュを活用して重複取得を防ぐ

## まとめ
- **現状**: タイトル＋snippetでの分析には限界がある
- **短期的解決**: まずsnippetベースで実装し、精度を検証
- **長期的解決**: 必要に応じて記事詳細取得機能を追加
- **重要**: ユーザー価値（分析の質）と技術的制約のバランスを取る

## 次のアクション
1. Snippetベースでの分析精度テスト
2. WebFetch APIの検証（単体記事での動作確認）
3. ユーザーフィードバックに基づく改善計画